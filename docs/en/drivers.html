<!DOCTYPE html>
<html lang="en">

<head>
  <title>Drivers | Documentation | Essh - Extended ssh command</title>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

  <link rel="shortcut icon" href="/essh/images/favicon.png" type="image/x-icon" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/agate.min.css">
<link rel="stylesheet" href="/essh/asciinema/asciinema-player.css">
<link rel="stylesheet" href="/essh/css/style.css">

</head>

<body class="layout-docs-single">
  <nav id="mainNav" class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
        data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
      </button>
      <a class="navbar-brand" href="/essh/">Essh</a>
    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a class="" href="/essh/intro/en/index.html">Intro</a>
        </li>
        <li>
          <a class="" href="/essh/docs/en/index.html">Docs</a>
        </li>
        <li>
          <a class="" href="https://github.com/sevir/essh">Github</a>
        </li>
        <li>
          <a class="" href="https://github.com/sevir/essh/releases/latest">Download</a>
        </li>

      </ul>
    </div>
  </div>
</nav>
  <section class="single content-wrapper">
    <div class="container">
      <div class="row">
        <div class="col-sm-9 col-sm-push-3">
          <div class="pull-right lang-list change-lang">
            
          </div>
          <section class="main-content">
            

<h1 id="drivers">Drivers</h1>

<p>Drivers in Essh are template system to construct shell scripts in tasks execution. You can use a driver to modify behavior of tasks.</p>

<h2 id="example">Example</h2>

<pre><code class="language-lua">-- defining a driver
driver &quot;custom_driver&quot; { 
    engine = [=[
        {{template &quot;environment&quot; .}}
        
        set -e
        indent() {
            local n=&quot;${1:-4}&quot;
            local p=&quot;&quot;
            for i in `seq 1 $n`; do
                p=&quot;$p &quot;
            done;

            local c=&quot;s/^/$p/&quot;
            case $(uname) in
              Darwin) sed -l &quot;$c&quot;;;
              *)      sed -u &quot;$c&quot;;;
            esac
        }
        
        {{range $i, $script := .Scripts -}}
        echo '==&gt; step {{$i}}:{{if $script.description}} {{$script.description}}{{end}}'
        { 
            {{$script.code}} 
        } | indent; __essh_exit_status=${PIPESTATUS[0]}
        if [ $__essh_exit_status -ne 0 ]; then
            exit $__essh_exit_status
        fi
        {{end}}
    ]=],
}

-- using defined driver in a task
task &quot;example&quot; {
    driver = &quot;custom_driver&quot;,
    script = {
        &quot;echo aaa&quot;,
        &quot;echo bbb&quot;,
    }
}
</code></pre>

<h2 id="environment-template">Environment template</h2>

<p>Essh provides environment template to generate bash code to set environment variables.
You can used it as <code>{{template &quot;environment&quot; .}}</code>.</p>

<h2 id="predefined-variables">Predefined variables</h2>

<p>You can use predefined variables in the driver engine text template.</p>

<ul>
<li><code>.Scripts</code>: This is a task&rsquo;s <code>script</code> value.</li>
</ul>

<h2 id="default-driver">Default driver</h2>

<p>If you define <code>default</code> driver like the following. This driver is used at default in the task instead of built-in default driver.</p>

<pre><code class="language-lua">driver &quot;default&quot; { 
    engine = [=[
    -- your driver code...
    ]=],
}

-- This task uses above default driver automatically.
task &quot;example&quot; {
    script = {
        &quot;echo aaa&quot;,
        &quot;echo bbb&quot;,
    }
}
</code></pre>

<h2 id="running-scripts-in-other-programming-languages">Running scripts in other programming languages</h2>

<p>You can run scripts in other programming languages by using a driver.</p>

<p>Why would you want to do this? There are a few reasons:</p>

<ul>
<li>You may want to use a language that is more familiar to you with more features than shell scripts.</li>
<li>Although you can write in lua language the hooks functions, scripts always run in a shell environment. If you want to run a script in a different environment, you can use a driver.</li>
<li>You may want to use a language that is more suitable for the task at hand.</li>
<li>If the language script interpreter is not installed on the target machine, you can use a driver to install it.</li>
</ul>

<p>For example, you can run a script in Python as follows.</p>

<p>Define the new driver:</p>

<pre><code class="language-lua">driver &quot;python&quot; {
    engine = [=[
        {{template &quot;environment&quot; .}}

        # Detect if python or python3 is installed, python3 is preferred
        if ! command -v python3 &amp;&gt; /dev/null
        then
            if ! command -v python &amp;&gt; /dev/null
            then
                echo &quot;Python could not be found. Please install it.&quot;
                exit 1
            else
                CMD=python
            fi
        else
                CMD=python3
        fi
        
        
        set -e

$CMD &lt;&lt;EOF
{{range $i, $script := .Scripts -}}
{{$script.code}} 
{{end -}}
EOF

        set +e
    ]=],
}
</code></pre>

<p>Use the driver in a task:</p>

<pre><code class="language-lua">task &quot;example&quot; {
    driver = &quot;python&quot;,
    script = [=[
# This is a python script, be careful with indentation
# Detect hostname and print it
import socket
hostname = socket.gethostname()
print(f&quot;Hello world from Python in {hostname}&quot;)
    ]=]
}
</code></pre>

<h3 id="other-useful-drivers">Other useful drivers</h3>

<p><strong>Deno driver</strong></p>

<pre><code class="language-lua">driver &quot;deno&quot; { 
    engine = [=[
        {{template &quot;environment&quot; .}}

        # Detect if deno is installed
        if ! command -v deno &amp;&gt; /dev/null
        then
            echo &quot;Deno could not be found. Please install it.&quot;
            exit 1
        fi
        
        set -e
deno run --unstable -q -A - &lt;&lt;EOF
{{range $i, $script := .Scripts -}}
    {{$script.code}} 
{{end -}}

EOF
        set +e
    ]=],
}
</code></pre>

<p>Example:</p>

<pre><code class="language-lua">task &quot;example-deno-task&quot; {
    driver = &quot;deno&quot;,
    script = [=[
        // This is a deno script
        // Detect hostname and print it
        console.log(&quot;Hello world from Deno in&quot;, Deno.hostname());
    ]=]
}
</code></pre>

<p><strong>ESSH Lua driver (since <em>3.5.0</em>)</strong></p>

<pre><code class="language-lua">driver &quot;essh-lua&quot; {
    engine = [=[
        {{template &quot;environment&quot; .}}

        # Detect if essh is installed
        if ! command -v essh &amp;&gt; /dev/null
        then
            echo &quot;essh could not be found. Please install it.&quot;
            exit 1
        fi
        
        set -e

essh --eval &lt;&lt;EOF
{{range $i, $script := .Scripts -}}
{{$script.code}} 
{{end -}}
EOF

        set +e
    ]=],
}
</code></pre>

<p>Example:</p>

<pre><code class="language-lua">task &quot;example-essh-lua-task&quot; {
    driver = &quot;essh-lua&quot;,
    script = [=[
        -- This is a essh-lua script
        print(&quot;Hello world from Essh-Lua&quot;)

        local sh = require(&quot;sh&quot;)
        sh.ls(&quot;-l&quot;,&quot;/&quot;):print()
    ]=]
}
</code></pre>

          </section>
        </div>
        <div class="col-sm-3 col-sm-pull-9">
          <section class="side-menu">
  <ul>
    <li><a href="index.html">Documentation</a></li>
    <li><a href="configuration-files.html">Configuration Files</a></li>
    <li><a href="hosts.html">Hosts</a></li>
    <li><a href="tasks.html">Tasks</a></li>
    <li><a href="lua-vm.html">Lua VM</a></li>
    <li><a href="cli-options.html">CLI Options</a></li>
    <li><a href="drivers.html">Drivers</a></li>
    <li><a href="groups.html">Groups</a></li>
    <li><a href="integrating-other-tools.html">Integrating Other Tools</a></li>
    <li><a href="scripting.html">Scripting</a></li>
  </ul>
</section>


        </div>

      </div>
    </div>
  </section>
  <footer>
  <div class="container">
    <p>2025 José F. Rives</p>
    <ul class="list-inline">
      <li>
        <a href="https://github.com/sevir/essh">Github</a>
      </li>
      <li>
        <a href="https://github.com/sevir/essh/issues">Issues</a>
      </li>
      <li>
        <a href="https://github.com/sevir/essh/releases">Releases</a>
      </li>
    </ul>
    <p>HTML template is <a href="https://github.com/BlackrockDigital/startbootstrap-new-age">startbootstrap-new-age</a>
      - Copyright 2013-2016 Blackrock Digital LLC.</p>
    <p>I use “Google Analytics” to collect information about use of this site.</p>
  </div>
</footer>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/languages/lua.min.js"></script>
<script type="text/javascript" src="/essh/asciinema/asciinema-player.js"></script>
<script type="text/javascript" src="/essh/js/bundle.js"></script>



<script>hljs.initHighlightingOnLoad();</script>


</body>

</html>